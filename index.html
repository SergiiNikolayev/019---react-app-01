<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>React APP</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.0/react.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.14.0/react-dom.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.6.15/browser.min.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="app"></div>
    <script type="text/babel" >
        var appId = document.getElementById('app');

        var Note = React.createClass({

            render: function () {
                var colorStyles = { backgroundColor: this.props.color };
                return (
                        <div className="note" style={colorStyles}>
                            <span className="edit-note" onClick={this.props.onEdit}>E</span>
                            <span className="delete-note" onClick={this.props.onDelete}>X</span>
                            {this.props.children}
                        </div>
                );
            }
        });



        var NoteEditor = React.createClass({
            getInitialState: function () {
                return{
                    text: '',
                    textDescription: ''
                };
            },

            handleTextChangeMoney: function (event) {
                this.setState({ text: event.target.value });
            },

            handleTextChangeDescription: function (event) {
                this.setState({ textDescription: event.target.value });
            },

            handleNoteAdd: function () {
                /** forming new object with new Note*/
                var newNote = {
                    text: this.state.text,
                    textDescription: this.state.textDescription,
                    category: '',
                    color: '#f5f506a1',
                    //when: date(),
                    id: Date.now()
                };

                this.props.onNoteAdd(newNote);
                //after adding we clearing input
                this.setState({text: ''});
                this.setState({textDescription: ''});
            },

            render: function () {
                return (
                        <div className="note-editor">
                            <input type="text" placeholder="How much $" value={this.state.text} className="input-money" onChange={this.handleTextChangeMoney}/>
                            <input type="text" placeholder="Description" value={this.state.textDescription} className="input-description" onChange={this.handleTextChangeDescription}/>
                            <select id="country" name="Category">
                                <option value="spend">Spendings</option>
                                <option value="income">Incomings</option>
                            </select>
                            <button className="add-button" onClick={this.handleNoteAdd}>Add</button>
                        </div>
                );
            }
        });

        var NotesGrid = React.createClass({
            render: function () {
                //var onNoteDelete = this.props.onNoteDelete;
                return (
                        <div className="notes-grid">
                            {
                                this.props.notes.map(function(note) {
                                    return <Note
                                                key={note.id}
                                                onDelete={()=>this.onNoteDelete /*we us bind for deleting write note*/ }
                                                color={note.color} > <span className="notes-money">
                                                    {note.text}
                                                    {note.when} </span> {note.textDescription}
                                            </Note>;
                                })
                            }
                        </div>
                )
            }
        });

        var NotesApp = React.createClass({
            getInitialState: function () {
                return {
                    notes: [
/*                        { //here stores array of notes
                            id: 0,
                            money: 100,
                            text: "qwerty",
                            color: "#ffd700"
                        }, {
                            id: 1,
                            money: 200,
                            text: "asdfgh",
                            color: "#20b2aa"
                        }, {
                            id: 2,
                            money: 150,
                            text: "zxcvbnm",
                            color: "#90ee90"
                        }*/
                    ]
                };
            },

            /** in order to for load web page get value that already saved in localStorage, we need in method componentDidMount read value, parse it and write to State
             *  also we need to write data to localStorage, we create for this method _updateLocalStorage*/
            componentDidMount: function () {
                var localNotes = JSON.parse(localStorage.getItem('notes')); //here we read 'notes' from localStorage, patse it, if is something write there -> add to state.
                if (localNotes){
                    this.setState({notes: localNotes});
                }
            },

            componentDidUpdate: function () {
                this._updateLocalStorage();
            },
            
            handleNoteDelete: function (note) {
                var noteId = note.id;
                var newNotes = this.state.notes.filter(function (note) {
                   return note.id !== noteId;
                });
                this.setState({notes: newNotes});
            },

            handleNoteAdd: function (newNote) {
                var newNotes = this.state.notes.slice();
                newNotes.unshift(newNote); //The unshift() method adds one or more elements to the beginning of an array and returns the new length of the array.
                this.setState({ notes: newNotes });
            },
            
            render: function () {
                return (
                        <div className="notes-app">
                            NotesApp
                            <NoteEditor onNoteAdd={this.handleNoteAdd}/>
                            <NotesGrid notes={this.state.notes} onDelete={this.handleNoteDelete}/>
                        </div>
                );
            },

            _updateLocalStorage: function () {
                var notes = JSON.stringify(this.state.notes); //converting to string everything what is in notes
                localStorage.setItem('notes', notes); //writing to localStorage Item notes
            }
        });

        ReactDOM.render(<NotesApp />, appId);
</script>
</body>
</html>